!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.v=t()}(this,function(){"use strict";var e={},t=function(t,n){"function"==typeof n&&(e[t]=n)},n=function(t,n){for(var i=[],r=arguments.length-2;r-- >0;)i[r]=arguments[r+2];var o=e[t];return o?o.apply(void 0,[n].concat(i)):n},i={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},r=function(e){return e+="",e.replace(/&(?![\w#]+;)|[<>"']/g,function(e){return i[e]})},o=Object.prototype.hasOwnProperty,s=function(e,t){if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++)t(e[n],n,e);else if("object"==typeof e)for(var r in e)o.call(e,r)&&t(e[r],r,e)},a={openTag:"{{",closeTag:"}}",escape:!0},c=Object.keys(a),f=Object.assign({},a),p=function(e,t){if(void 0===t)return f[e];if(~c.indexOf(e)){var n;return f=Object.assign(f,(n={},n[e]=t,n))}},u={escape:r,filter:n,each:s};return{config:p,compile:function(e){var t=p("openTag"),n=p("closeTag"),i=p("escape"),r=e.replace(/\s+/g," ").split(new RegExp("("+t+"|"+n+")","g")),o=[],s=[],a=1,c=!1;r.forEach(function(e,i){var r;switch(e){case t:c=!0;break;case n:c=!1;break;default:r={content:e.trim(),position:i},s.push({content:e,position:i,type:c?"code":"html",refer:r}),c&&o.push(r)}}),o.forEach(function(e,t){var n=e.content.split(" "),i=n[0];if("if"===i||"each"===i)for(var r=o.length-1;r>t;r--)if(!o[r].binded&&new RegExp("^/"+i).test(o[r].content)){o[r].binded=!0,e.bind=o[r].position;break}}),o.forEach(function(e,t){if("else"===e.content.split(" ")[0])for(var n=t-1;n>=0;n--)if(o[n].bind&&o[n].bind>e.position&&/^if\s+/.test(o[n].content)){e.belong=o[n].position;break}});var f=function(e,t){return"\n\t\t\t"+(t?"var $e"+t+";":"")+"\n\t\t\twith( $data ) {\n\t\t\t\t$e"+(t||"")+" = "+e+";\n\t\t\t}\n\t\t"},l=function(e){var t=e.split(" as ");if(2===t.length){var n=t[1].split(","),i=n[1]||"$i",r=n[0]||"$v";return{items:t[0],v:r,i:i}}},h=[];return h.push('\n\t\tvar $o = "";\n\t\tvar $util = this;\n\t\tvar $escape = $util.escape;\n\t\tvar $filter = $util.filter;\n\t\tvar $each = $util.each;\n\t\t$data = $data || {};\n\t'),s.forEach(function(e){if("html"===e.type)h.push("$o += "+JSON.stringify(e.content)+";");else if("code"===e.type){var t=e.content.trim(),n=t.split(" "),r=n[0],o=n.slice(1);if("if"===r)e.declare=[],e.declare.push(f(o.join(" "),a)),h.push(e.declare),h.push("if( $e"+a+" ) {"),a++;else if("else"===r){var c;"if"===o[0]?(s.forEach(function(t){if(t.position===e.refer.belong)return c=t,!1}),c.declare.push(f(o.slice(1).join(" "),a)),h.push("} else if( $e"+a+" ) {"),a++):h.push("} else {")}else if("each"===r){var p=l(o.join(" "));h.push(f(p.items,a)),h.push("$each($e"+a+", function("+p.v+", "+p.i+") {\n\t\t\t\t"),a++}else if("/if"===r)h.push("}");else if("/each"===r)h.push("});");else{var u=t.split("|"),v=u[0],d=u.slice(1);if("="!==v[0]){h.push(f(v,a)),v="$e"+a;for(var $=0,g=d.length;$<g;$++){var b=d[$].split(":"),y=b[0].trim(),j=b.slice(1).join("");v="$filter( "+JSON.stringify(y)+", "+v+" "+(j?","+j:"")+" )"}i?h.push("$o += $escape("+v+");"):h.push("$o += "+v+";"),a++}else h.push(f(v.slice(1),a)),h.push("$o += $e"+a+";"),a++}}}),h.push("return $o;"),h=h.map(function(e){return Array.isArray(e)?e.join(""):e}),new Function("$data",h.join("\n")).bind(u)},registerFilter:t}});
