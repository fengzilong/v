!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.v=t()}(this,function(){"use strict";function e(e,t){if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++)t(e[n],n,e);else if("object"==typeof e)for(var r in e)f.call(e,r)&&t(e[r],r,e)}function t(e,t){if("undefined"==typeof t)return u[e];if(~p.indexOf(e)){var n;return u=Object.assign(u,(n={},n[e]=t,n))}}function n(e){var n=t("openTag"),i=t("closeTag"),r=t("escape"),o=e.replace(/\s+/g," ").split(new RegExp("("+n+"|"+i+")","g")),s=[],a=[],f=1,c=!1;o.forEach(function(e,t){var r;switch(e){case n:c=!0;break;case i:c=!1;break;default:r={content:e.trim(),position:t},a.push({content:e,position:t,type:c?"code":"html",refer:r}),c&&s.push(r)}}),s.forEach(function(e,t){var n=e.content.split(" "),i=n[0];if("if"===i||"each"===i)for(var r=s.length-1;r>t;r--)if(!s[r].binded&&new RegExp("^/"+i).test(s[r].content)){s[r].binded=!0,e.bind=s[r].position;break}}),s.forEach(function(e,t){var n=e.content.split(" "),i=n[0];if("else"===i)for(var r=t-1;r>=0;r--)if(s[r].bind&&s[r].bind>e.position&&/^if\s+/.test(s[r].content)){e.belong=s[r].position;break}});var p=function(e,t){return"\n\t\t\t"+(t?"var $e"+t+";":"")+"\n\t\t\twith( $data ) {\n\t\t\t\t$e"+(t||"")+" = "+e+";\n\t\t\t}\n\t\t"},u=function(e){var t=e.split(" as ");if(2===t.length){var n=t[1].split(","),i=n[1]||"$i",r=n[0]||"$v";return{items:t[0],v:r,i:i}}},h=[];return h.push('\n\t\tvar $o = "";\n\t\tvar $util = this;\n\t\tvar $escape = $util.escape;\n\t\tvar $filter = $util.filter;\n\t\tvar $each = $util.each;\n\t\t$data = $data || {};\n\t'),a.forEach(function(e){if("html"===e.type)h.push("$o += "+JSON.stringify(e.content)+";");else if("code"===e.type){var t=e.content.trim(),n=t.split(" "),i=n[0],o=n.slice(1);if("if"===i)e.declare=[],e.declare.push(p(o.join(" "),f)),h.push(e.declare),h.push("if( $e"+f+" ) {"),f++;else if("else"===i){var s;"if"===o[0]?(a.forEach(function(t){if(t.position===e.refer.belong)return s=t,!1}),s.declare.push(p(o.slice(1).join(" "),f)),h.push("} else if( $e"+f+" ) {"),f++):h.push("} else {")}else if("each"===i){var c=u(o.join(" "));h.push(p(c.items,f)),h.push("$each($e"+f+", function("+c.v+", "+c.i+") {\n\t\t\t\t"),f++}else if("/if"===i)h.push("}");else if("/each"===i)h.push("});");else{var l=t.split("|"),v=l[0],d=l.slice(1);if("="!==v[0]){h.push(p(v,f)),v="$e"+f;for(var $=0,g=d.length;$<g;$++){var y=d[$].split(":"),b=y[0].trim(),j=y.slice(1).join("");v="$filter( "+JSON.stringify(b)+", "+v+" "+(j?","+j:"")+" )"}r?h.push("$o += $escape("+v+");"):h.push("$o += "+v+";"),f++}else h.push(p(v.slice(1),f)),h.push("$o += $e"+f+";"),f++}}}),h.push("return $o;"),h=h.map(function(e){return Array.isArray(e)?e.join(""):e}),new Function("$data",h.join("\n")).bind(l)}var i={},r=function(e,t){"function"==typeof t&&(i[e]=t)},o=function(e,t){for(var n=[],r=arguments.length-2;r-- >0;)n[r]=arguments[r+2];var o=i[e];return o?o.apply(void 0,[t].concat(n)):t},s={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},a=function(e){return e+="",e.replace(/&(?![\w#]+;)|[<>"']/g,function(e){return s[e]})},f=Object.prototype.hasOwnProperty,c={openTag:"{{",closeTag:"}}",escape:!0},p=Object.keys(c),u=Object.assign({},c),l={escape:a,filter:o,each:e},h={config:t,compile:n,registerFilter:r};return h});