!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.v=t()}(this,function(){"use strict";var e={},t=function(t,n){"function"==typeof n&&(e[t]=n)},n=function(t,n){for(var i=arguments.length,r=Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];var s=e[t];return s?s.apply(void 0,[n].concat(r)):n},i={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},r=function(e){return e+="",e.replace(/&(?![\w#]+;)|[<>"']/g,function(e){return i[e]})},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},s=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},f=Object.prototype.hasOwnProperty,c=function(e,t){if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++)t(e[n],n,e);else if("object"===("undefined"==typeof e?"undefined":o(e)))for(var r in e)f.call(e,r)&&t(e[r],r,e)},a={openTag:"{{",closeTag:"}}",escape:!0},u=Object.keys(a),p=Object.assign({},a),l=function(e,t){if("undefined"==typeof t)return p[e];if(~u.indexOf(e))return p=Object.assign(p,s({},e,t))},h={escape:r,filter:n,each:c},d=function(e){var t=l("openTag"),n=l("closeTag"),i=l("escape"),r=e.replace(/\s+/g," ").split(new RegExp("("+t+"|"+n+")","g")),o=[],s=[],f=1,c=!1;r.forEach(function(e,i){var r=void 0;switch(e){case t:c=!0;break;case n:c=!1;break;default:r={content:e.trim(),position:i},s.push({content:e,position:i,type:c?"code":"html",refer:r}),c&&o.push(r)}}),o.forEach(function(e,t){var n=e.content.split(" "),i=n[0];if("if"===i||"each"===i)for(var r=o.length-1;r>t;r--)if(!o[r].binded&&new RegExp("^/"+i).test(o[r].content)){o[r].binded=!0,e.bind=o[r].position;break}}),o.forEach(function(e,t){var n=e.content.split(" "),i=n[0];if("else"===i)for(var r=t-1;r>=0;r--)if(o[r].bind&&o[r].bind>e.position&&/^if\s+/.test(o[r].content)){e.belong=o[r].position;break}});var a=function(e,t){return"\n\t\t\t"+(t?"var $e"+t+";":"")+"\n\t\t\twith( $data ) {\n\t\t\t\t$e"+(t||"")+" = "+e+";\n\t\t\t}\n\t\t"},u=function(e){var t=e.split(" as ");if(2===t.length){var n=t[1].split(","),i=n[1]||"$i",r=n[0]||"$v";return{items:t[0],v:r,i:i}}},p=[];return p.push('var $o = "";'),p.push("var $util = this;"),p.push("var $escape = $util.escape;"),p.push("var $filter = $util.filter;"),p.push("var $each = $util.each;"),s.forEach(function(e){if("html"===e.type)p.push("$o += "+JSON.stringify(e.content)+";");else if("code"===e.type){var t=e.content.trim(),n=t.split(" "),r=n[0],o=n.slice(1);if("if"===r)e.declare=[],e.declare.push(a(o.join(" "),f)),p.push(e.declare),p.push("if( $e"+f+" ) {"),f++;else if("else"===r){var c=void 0;"if"===o[0]?(s.forEach(function(t){if(t.position===e.refer.belong)return c=t,!1}),c.declare.push(a(o.slice(1).join(" "),f)),p.push("} else if( $e"+f+" ) {"),f++):p.push("} else {")}else if("each"===r){var l=u(o.join(" "));p.push(a(l.items,f)),p.push("$each($e"+f+", function("+l.v+", "+l.i+") {\n\t\t\t\t"),f++}else if("/if"===r)p.push("}");else if("/each"===r)p.push("});");else{var h=t.split("|"),d=h[0],v=h.slice(1);if("="!==d[0]){p.push(a(d,f)),d="$e"+f;for(var y=0,b=v.length;y<b;y++){var $=v[y].split(":"),g=$[0].trim(),m=$.slice(1).join("");d="$filter( "+JSON.stringify(g)+", "+d+" "+(m?","+m:"")+" )"}i?p.push("$o += $escape("+d+");"):p.push("$o += "+d+";"),f++}else p.push(a(d.slice(1),f)),p.push("$o += $e"+f+";"),f++}}}),p.push("return $o;"),p=p.map(function(e){return Array.isArray(e)?e.join(""):e}),new Function("$data",p.join("\n")).bind(h)},v={config:l,compile:d,registerFilter:t,version:"0.0.0"};return v});