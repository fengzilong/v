!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.v=t()}(this,function(){"use strict";var e={},t=function(t,n){"function"==typeof n&&(e[t]=n)},n=function(t,n){for(var i=arguments.length,r=Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];var s=e[t];return s?s.apply(void 0,[n].concat(r)):n},i={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},r=function(e){return e+="",e.replace(/&(?![\w#]+;)|[<>"']/g,function(e){return i[e]})},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},s=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},f=Object.prototype.hasOwnProperty,c=function(e,t){if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++)t(e[n],n,e);else if("object"===("undefined"==typeof e?"undefined":o(e)))for(var r in e)f.call(e,r)&&t(e[r],r,e)},a={openTag:"{{",closeTag:"}}",escape:!0},u=Object.keys(a),p=Object.assign({},a),l=function(e,t){if("undefined"==typeof t)return p[e];if(~u.indexOf(e))return p=Object.assign(p,s({},e,t))},h={escape:r,filter:n,each:c},d=function(e){var t=l("openTag"),n=l("closeTag"),i=l("escape"),r=[],o=1,s=e.replace(/\s+/g," ").split(new RegExp("("+t+"|"+n+")","g")),f=[],c=[],a=[],u=!1;s.forEach(function(e,i){var r;switch(e){case t:u=!0;break;case n:u=!1;break;default:r={content:e,position:i},a.push({content:e,position:i,type:u?"code":"html",refer:r}),u?c.push(r):f.push(r)}}),c.forEach(function(e,t){var n=e.content.split(" "),i=n[0];if("if"===i||"each"===i)for(var r=c.length-1;r>t;r--)if(!c[r].binded&&new RegExp("^/"+i).test(c[r].content)){c[r].binded=!0,e.bind=c[r].position;break}}),c.forEach(function(e,t){var n=e.content.split(" "),i=n[0];if("else"===i)for(var r=t-1;r>=0;r--)if(c[r].bind&&c[r].bind>e.position&&/^if\s+/.test(c[r].content)){e.belong=c[r].position;break}});var p=function(e,t){return"\n\t\t\t"+(t?"var $e"+t+";":"")+"\n\t\t\twith( $data ) {\n\t\t\t\t$e"+(t||"")+" = "+e+";\n\t\t\t}\n\t\t"},d=function(e){var t=e.split(" as ");if(2===t.length){var n=t[1].split(","),i=n[1]||"$i",r=n[0]||"$v";return{items:t[0],v:r,i:i}}};return r.push('var $o = "";'),r.push("var $util = this;"),r.push("var $escape = $util.escape;"),r.push("var $filter = $util.filter;"),r.push("var $each = $util.each;"),a.forEach(function(e){if("html"===e.type)r.push('$o += "'+e.content+'";');else if("code"===e.type){var t=e.content.trim(),n=t.split(" "),s=n[0],f=n.slice(1);if("if"===s)e.declare=[],e.declare.push(p(f.join(" "),o)),r.push(e.declare),r.push("if( $e"+o+" ) {"),o++;else if("else"===s){var c=void 0;"if"===f[0]?(a.forEach(function(t){if(t.position===e.refer.belong)return c=t,!1}),c.declare.push(p(f.splice(1).join(" "),o)),r.push("} else if( $e"+o+" ) {"),o++):r.push("} else {")}else if("each"===s){var u=d(f.join(" "));r.push(p(u.items,o)),r.push("$each($e"+o+", function("+u.v+", "+u.i+") {\n\t\t\t\t"),o++}else if("/if"===s)r.push("}");else if("/each"===s)r.push("})");else{var l=t.split("|"),h=l[0],v=l.slice(1);if("="!==h[0]){r.push(p(h,o)),h="$e"+o;for(var y=0,b=v.length;y<b;y++){var $=v[y].split(":"),g=$[0].trim(),m=$.slice(1).join("");h="$filter( "+JSON.stringify(g)+", "+h+" "+(m?","+m:"")+" )"}i?r.push("$o += $escape("+h+");"):r.push("$o += "+h+";"),o++}else r.push(p(h.slice(1),o)),r.push("$o += $e"+o+";"),o++}}}),r.push("return $o;"),r=r.map(function(e){return Array.isArray(e)?e.join(""):e}),new Function("$data",r.join("\n")).bind(h)},v={config:l,compile:d,registerFilter:t,version:"0.0.0"};return v});